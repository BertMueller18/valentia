<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Valentia : PowerShell Remote deployment library for Windows Servers" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Valentia</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/guitarrapc/valentia">View on GitHub</a>

          <h1 id="project_title">Valentia</h1>
          <h2 id="project_tagline">PowerShell Remote deployment library for Windows Servers</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/guitarrapc/valentia/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/guitarrapc/valentia/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="read-me-fast" class="anchor" href="#read-me-fast"><span class="octicon octicon-link"></span></a>Read Me Fast</h1>

<p>Valentia is PowerShell deployment tool for Server-Client model.
This module set will optimize your work for deploy Commands or files to remote servers.</p>

<h1>
<a name="special-thanks" class="anchor" href="#special-thanks"><span class="octicon octicon-link"></span></a>Special Thanks</h1>

<p>Valentia inspired from <a href="https://github.com/capistrano/capistrano">capistrano</a> and <a href="https://github.com/psake/psake">psake</a>. They are fantastic and awesome tools for automation and DevOps. Especially psake showed cool way of coding and valentia followed in many points. Also <a href="http://newsqlblog.com/category/powershell/powershell-concurrency/">psasync</a> and <a href="http://learn-powershell.net/2012/05/13/using-background-runspaces-instead-of-psjobs-for-better-performance/">Get-NetworkInfo</a> give me inspire to do asynchronous execution.</p>

<h1>
<a name="latest-change" class="anchor" href="#latest-change"><span class="octicon octicon-link"></span></a>Latest Change</h1>

<h2>
<a name="version-035" class="anchor" href="#version-035"><span class="octicon octicon-link"></span></a>Version 0.3.5</h2>

<p>[ author : guitarrapc ]</p>

<p>[ Feb 13, 2013 ]</p>

<ul>
<li>fix issue #54 : Invoke-Valentia waiting for job finish before passing next command to jobs.</li>
<li>tune RunSpacePool configutaion #55 : Check preferred number of RunSpaces to execute most efficiently</li>
<li>enhanced issue #52 : change Ping-ValentiaGroupAsync from PSEventJob to System.Threading.Tasks.task</li>
</ul><h1>
<a name="valid-os-and-powershell-verstion" class="anchor" href="#valid-os-and-powershell-verstion"><span class="octicon octicon-link"></span></a>Valid OS and PowerShell Verstion</h1>

<table>
<thead><tr>
<th>OS</th>
<th>PowerShell</th>
</tr></thead>
<tbody>
<tr>
<td>Windows 7 SP1</td>
<td>PowerShell V3.0 and higher</td>
</tr>
<tr>
<td>Windows 8</td>
<td>PowerShell V3.0 and higher</td>
</tr>
<tr>
<td>Windows 8.1</td>
<td>PowerShell V4.0 and higher</td>
</tr>
<tr>
<td>Windows 2012</td>
<td>PowerShell V3.0 and higher</td>
</tr>
<tr>
<td>Windows 2012 R2</td>
<td>PowerShell V4.0 and higher</td>
</tr>
</tbody>
</table><h4>
<a name="note-all-functions-are-confirmed-with-windows-server-2012-x64-english-environment" class="anchor" href="#note-all-functions-are-confirmed-with-windows-server-2012-x64-english-environment"><span class="octicon octicon-link"></span></a>NOTE: All functions are confirmed with Windows Server 2012 x64 English environment.</h4>

<h1>
<a name="prerequisite" class="anchor" href="#prerequisite"><span class="octicon octicon-link"></span></a>Prerequisite</h1>

<ul>
<li>You need to install followings to use valentia file transfer.</li>
</ul><table>
<thead><tr>
<th>#</th>
<th>Description</th>
<th>Note</th>
</tr></thead>
<tbody>
<tr>
<td>1.</td>
<td>Enable "IIS BITs Transfer" for single and List file transfer from "Windows Program and freature"</td>
<td></td>
</tr>
<tr>
<td>2.</td>
<td>Install "FastCopy" to Sync Folders. (please intstall FastCopyx64 to "C:\Program Files\FastCopy")</td>
<td><a href="http://ipmsg.org/tools/fastcopy.html">Download FastCopy?</a></td>
</tr>
<tr>
<td>3.</td>
<td>Make sure you can execute PowerShell Script with Execution Policy. To enable Execution Policy then run following command with Admin elevated PowerShell.</td>
<td><code>Set-ExecutionPolicy RemoteSigned</code></td>
</tr>
</tbody>
</table><h1>
<a name="easy-install-" class="anchor" href="#easy-install-"><span class="octicon octicon-link"></span></a>Easy Install !!</h1>

<ul>
<li>Let's start install valentia now, Open PowerShell or Command prompt, paste the text below and press Enter.</li>
</ul><table>
<thead><tr>
<th></th>
</tr></thead>
<tbody><tr>
<td><strong>powershell -NoProfile -ExecutionPolicy unrestricted -Command 'iex ([Text.Encoding]::UTF8.GetString([Convert]::FromBase64String((irm "<a href="https://api.github.com/repos/guitarrapc/valentia/contents/valentia/RemoteInstall.ps1%22).Content))).Remove(0,1)">https://api.github.com/repos/guitarrapc/valentia/contents/valentia/RemoteInstall.ps1").Content))).Remove(0,1)</a>'</strong></td>
</tr></tbody>
</table><p>After the installation complete, you will find valentia installed into your user's Module folder.</p>

<div class="highlight highlight-PowerShell"><pre><span class="nv">$env:USERPROFILE</span><span class="p">\</span><span class="n">Documents</span><span class="p">\</span><span class="n">WindowsPowerShell</span><span class="p">\</span><span class="n">Modules</span>
</pre></div>

<h2>
<a name="custom-install" class="anchor" href="#custom-install"><span class="octicon octicon-link"></span></a>Custom Install</h2>

<h3>
<a name="local-installation-for-user" class="anchor" href="#local-installation-for-user"><span class="octicon octicon-link"></span></a>Local Installation for user</h3>

<ul>
<li>If Remote installation are not allowed in your environment, set valentia in any path then you can install valentia localy with run <code>install.bat</code>,  this bat file copy valentia to user module path </li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="nv">$env:USERPROFILE</span><span class="p">\</span><span class="n">Documents</span><span class="p">\</span><span class="n">WindowsPowerShell</span><span class="p">\</span><span class="n">Modules</span>
</pre></div>

<h3>
<a name="use-valentia-for-all-users" class="anchor" href="#use-valentia-for-all-users"><span class="octicon octicon-link"></span></a>Use valentia for all users.</h3>

<ul>
<li>In case you want to use valentia with all users, then set valentia module folder to:</li>
</ul><pre><code>C:\Windows\System32\WindowsPowerShell\v1.0\Modules\valentia
</code></pre>

<h2>
<a name="import-valentia-module" class="anchor" href="#import-valentia-module"><span class="octicon octicon-link"></span></a>Import valentia module</h2>

<ul>
<li><p>In PowerShell V3.0, all modules located in default Module Path will be automatically search and loaded before starting script.</p></li>
<li><p>If you sat module into custom path, means not default Module Path, PowerShell will not automatically load yout module. In this case, please use Import-Module cmdlet in where <code>valentia.psd1</code> locating.</p></li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="n">cd</span> <span class="s2">"move to custom path you sat valentia.psd1"</span>
<span class="nb">Import-Module</span> <span class="n">valentia</span>
</pre></div>

<ul>
<li>While valentia sat in standard Module Path, described in "Easy Install", you don't need to import manually. However <code>Import-Module valentia</code> will import $valentia variables, and it will be help you some.</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="nb">Import-Module</span> <span class="n">valentia</span>
</pre></div>

<h1>
<a name="valentia-functions" class="anchor" href="#valentia-functions"><span class="octicon octicon-link"></span></a>valentia functions</h1>

<ul>
<li>You can see valentia functions by following command.</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="nb">Get-command</span> <span class="n">-module</span> <span class="n">valentia</span>
</pre></div>

<ul>
<li>Following functions will be shown.</li>
</ul><table>
<thead><tr>
<th>CommandType</th>
<th>Name</th>
<th>ModuleName</th>
</tr></thead>
<tbody>
<tr>
<td>Function</td>
<td>ConvertTo-ValentiaTask</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Edit-ValentiaConfig</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Get-ValentiaCredential</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Get-ValentiaFileEncoding</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Get-ValentiaGroup</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Get-ValentiaRebootRequiredStatus</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Get-ValentiaTask</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Initialize-ValentiaEnvironment</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Invoke-Valentia</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Invoke-ValentiaAsync</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Invoke-ValentiaClean</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Invoke-ValentiaCommand</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Invoke-valentiaDeployGroupRemark</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Invoke-ValentiaDeployGroupUnremark</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Invoke-ValentiaDownload</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Invoke-ValentiaParallel</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Invoke-ValentiaSync</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Invoke-ValentiaUpload</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Invoke-ValentiaUploadList</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>New-ValentiaCredential</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>New-ValentiaFolder</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>New-ValentiaGroup</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Ping-ValentiaGroupAsync</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Set-ValentiaHostName</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Set-ValentiaLocation</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Show-ValentiaConfig</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Show-ValentiaGroup</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Show-ValentiaPromptForChoice</td>
<td>valentia</td>
</tr>
<tr>
<td>Function</td>
<td>Test-ValentiaGroupConnection</td>
<td>valentia</td>
</tr>
<tr>
<td>Workflow</td>
<td>Invoke-ValentiaCommandParallel</td>
<td>valentia</td>
</tr>
</tbody>
</table><h1>
<a name="valentia-alias" class="anchor" href="#valentia-alias"><span class="octicon octicon-link"></span></a>valentia Alias</h1>

<ul>
<li>valentia functions have Alias to let you use it easir, you can find them as like this.</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="nb">Get-Alias</span> <span class="p">|</span> <span class="n">where</span> <span class="n">ModuleName</span> <span class="o">-eq</span> <span class="s2">"valentia"</span>
</pre></div>

<ul>
<li>This show alias defined in valentia</li>
</ul><table>
<thead><tr>
<th>CommandType</th>
<th>Name</th>
<th>ResolveCommandName</th>
<th>ModuleName</th>
</tr></thead>
<tbody>
<tr>
<td>Alias</td>
<td>Clean</td>
<td>Invoke-ValentiaClean</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>Cred</td>
<td>Get-ValentiaCredential</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>Download</td>
<td>Invoke-ValentiaDownload</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>Go</td>
<td>Set-ValentiaLocation</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>Initial</td>
<td>Initialize-ValentiaEnvironment</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>ipremark</td>
<td>Invoke-valentiaDeployGroupRemark</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>ipunremark</td>
<td>Invoke-ValentiaDeployGroupUnremark</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>PingAsync</td>
<td>Ping-ValentiaGroupAsync</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>Rename</td>
<td>Set-ValentiaHostName</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>Sync</td>
<td>Invoke-ValentiaSync</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>Target</td>
<td>Get-ValentiaGroup</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>Task</td>
<td>Get-ValentiaTask</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>Upload</td>
<td>Invoke-ValentiaUpload</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>UploadL</td>
<td>Invoke-ValentiaUploadList</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>Vale</td>
<td>Invoke-Valentia</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>Valea</td>
<td>Invoke-ValentiaAsync</td>
<td>Valentia</td>
</tr>
<tr>
<td>Alias</td>
<td>Valep</td>
<td>Invoke-ValentiaParallel</td>
<td>Valentia</td>
</tr>
</tbody>
</table><h1>
<a name="execute-deploy-commands" class="anchor" href="#execute-deploy-commands"><span class="octicon octicon-link"></span></a>Execute deploy Commands</h1>

<ul>
<li>After you satup Server/Clients, Credential amd DeproyGroups you can start execution.</li>
</ul><h2>
<a name="1-vale--back-ground-job-execution" class="anchor" href="#1-vale--back-ground-job-execution"><span class="octicon octicon-link"></span></a>1. <code>vale</code> : Back ground job execution.</h2>

<blockquote>
<p><strong>vale</strong> is Alias of <code>Invoke-Valentia</code>. This will execute Command to deploy group as back ground job.</p>

<p>vale is the standard way of valentia Command execution to the host, and quite fast in many cases. (Invoke-Valentia will run like Asynchros.)</p>
</blockquote>

<p>You have 2 choice executing command to host.</p>

<table>
<thead><tr>
<th>#</th>
<th>Run</th>
<th>Expression</th>
</tr></thead>
<tbody>
<tr>
<td>1.</td>
<td>ScriptBlock</td>
<td><code>vale Deploygroup {ScriptBlock}</code></td>
</tr>
<tr>
<td>2.</td>
<td>Task File</td>
<td><code>vale DeployGroup .\Taskfile.ps1</code></td>
</tr>
</tbody>
</table><h2>
<a name="2-valep--powershell-workflow-inlinescript-exection" class="anchor" href="#2-valep--powershell-workflow-inlinescript-exection"><span class="octicon octicon-link"></span></a>2. <code>valep</code> : PowerShell WorkFlow InlineScript exection.</h2>

<blockquote>
<p><strong>valep</strong> is Alias of <code>Invoke-ValentiaParallel</code>. This will execute Command to deploy group as PowreShell WorkFlow.</p>

<p>This function have limitation of PSWorkflow as it can only execute 5 commands at once, next 5 will execute when previous set was completed.</p>

<p>However if command execute in same PSHost process then valep can be fastest way of execution. It means if valep use same session as previous.</p>
</blockquote>

<p>You have 2 choice executing command to host.</p>

<table>
<thead><tr>
<th>#</th>
<th>Run</th>
<th>Expression</th>
</tr></thead>
<tbody>
<tr>
<td>1.</td>
<td>ScriptBlock</td>
<td><code>valep Deploygroup {ScriptBlock}</code></td>
</tr>
<tr>
<td>2.</td>
<td>Task File</td>
<td><code>valep DeployGroup .\Taskfile.ps1</code></td>
</tr>
</tbody>
</table><h4>
<a name="note-you-can-not-call-valep-from-c-calling-valentia-this-is-limitation-of-psworkflow" class="anchor" href="#note-you-can-not-call-valep-from-c-calling-valentia-this-is-limitation-of-psworkflow"><span class="octicon octicon-link"></span></a>NOTE: You can not call <code>valep</code> from C# calling valentia. This is limitation of PSWorkflow.</h4>

<h2>
<a name="3-valea--asynchronous-runspace-command-invokation" class="anchor" href="#3-valea--asynchronous-runspace-command-invokation"><span class="octicon octicon-link"></span></a>3. <code>valea</code> : Asynchronous RunSpace Command invokation.</h2>

<blockquote>
<p><strong>valea</strong> is Alias of <code>Invoke-ValentiaAsync</code>. This will execute Command to deploy group as RunSpacePooling.</p>

<p>valea is the asynchronous way of valentia Command execution to the host, and quite fast in most of the cases.</p>
</blockquote>

<p>You have 2 choice executing command to host.</p>

<table>
<thead><tr>
<th>#</th>
<th>Run</th>
<th>Expression</th>
</tr></thead>
<tbody>
<tr>
<td>1.</td>
<td>ScriptBlock</td>
<td><code>valea Deploygroup {ScriptBlock}</code></td>
</tr>
<tr>
<td>2.</td>
<td>Task File</td>
<td><code>valea DeployGroup .\Taskfile.ps1</code></td>
</tr>
</tbody>
</table><h1>
<a name="execute-file-transfer-commands" class="anchor" href="#execute-file-transfer-commands"><span class="octicon octicon-link"></span></a>Execute File transfer Commands</h1>

<h3>
<a name="1-upload--single-file-upload-from-server-to-clients" class="anchor" href="#1-upload--single-file-upload-from-server-to-clients"><span class="octicon octicon-link"></span></a>1. <code>upload</code> : Single File Upload from Server to Clients</h3>

<blockquote>
<p><strong>upload</strong> is Alias of <code>Invoke-ValentiaUpload</code>. You can upload file to client.</p>

<p>This function wrapps BITs Transfer inside and you can use option of BITS Transfer.</p>
</blockquote>

<h4>
<a name="note-the-files-using-to-upload-must-set-in-cdeploymentupload-at-server-side" class="anchor" href="#note-the-files-using-to-upload-must-set-in-cdeploymentupload-at-server-side"><span class="octicon octicon-link"></span></a>NOTE: The files using to upload must set in C:\Deployment\Upload at Server side.</h4>

<p>You have 2 choice executing command to host.</p>

<p>ex ) Upload file c:\deployment\upload\upload.txt to Remote Client C:\ for DeployGroup new is.</p>

<table>
<thead><tr>
<th>#</th>
<th>Run</th>
<th>Expression</th>
</tr></thead>
<tbody>
<tr>
<td>1.</td>
<td>Synchronous</td>
<td><code>upload -SourceFile "hoge.txt" -DestinationFolder c:\ -DeployGroup new</code></td>
</tr>
<tr>
<td>2.</td>
<td>Asynchronous</td>
<td><code>upload -SourceFile "hoge.txt" -DestinationFolder c:\ -DeployGroup new -Async</code></td>
</tr>
</tbody>
</table><h3>
<a name="2-uploadl--files-in-list-upload-from-server-to-clients" class="anchor" href="#2-uploadl--files-in-list-upload-from-server-to-clients"><span class="octicon octicon-link"></span></a>2. <code>uploadL</code> : Files in List Upload from Server to Clients</h3>

<blockquote>
<p><strong>uploadL</strong> is Alias of <code>Invoke-ValentiaUploadList</code>. You can upload multiple files listed in file.</p>

<p>This function wrapps BITs Transfer inside and you can use option of BITS Transfer.</p>
</blockquote>

<h4>
<a name="note-the-files-using-to-upload-must-set-in-cdeploymentupload-at-server-side-1" class="anchor" href="#note-the-files-using-to-upload-must-set-in-cdeploymentupload-at-server-side-1"><span class="octicon octicon-link"></span></a>NOTE: The files using to upload must set in C:\Deployment\Upload at Server side.</h4>

<ul>
<li>List File format should like this.</li>
</ul><pre><code>Source, Destination
C:\Deployment\Upload\DownLoad.txt,\\10.0.4.100\C$
C:\Deployment\Upload\hogehoge.txt,\\10.0.4.100\C$
</code></pre>

<blockquote>
<p>1st top line is an "Header" for Source, Destination.</p>

<p>2nd line is SourceFile fullpath and Destination folder full path to transfer.</p>

<p>Keep Deleimiter as ",".</p>
</blockquote>

<p>ex ) Upload files listed in c:\deployment\upload\list.txt to Remote Client C:\ for DeployGroup new is.</p>

<table>
<thead><tr>
<th>#</th>
<th>Run</th>
<th>Expression</th>
</tr></thead>
<tbody>
<tr>
<td>1.</td>
<td>Synchronous</td>
<td><code>UploadL -ListFile list.txt -DestinationFolder c:\ -DeployGroup new</code></td>
</tr>
<tr>
<td>2.</td>
<td>Asynchronous</td>
<td><code>UploadL -ListFile list.txt -DestinationFolder c:\ -DeployGroup new -Async</code></td>
</tr>
</tbody>
</table><h3>
<a name="3-sync--sync-server-folder-and-files-with-clients-diff-mode" class="anchor" href="#3-sync--sync-server-folder-and-files-with-clients-diff-mode"><span class="octicon octicon-link"></span></a>3. <code>sync</code> : Sync Server Folder and Files with Clients (DIFF mode)</h3>

<blockquote>
<p><strong>sync</strong> is Alias of <code>Invoke-ValentiaSync</code>. You can Synchronise DeployServer folder and Clients Folder.</p>

<p>Parent will be DeployServer, it means clietns folder will be changed to sync as like as DeployServer.</p>

<p>This function wrapps FastCopy.exe inside and you need install FastCopy.exe inadvance.</p>
</blockquote>

<p>ex ) sync folder C:\Requirements to Remote Client folder "C:\hoge hoge" for DeployGroup new is.</p>

<table>
<thead><tr>
<th>#</th>
<th>Run</th>
<th>Expression</th>
</tr></thead>
<tbody>
<tr>
<td>1.</td>
<td>Synchronous</td>
<td><code>sync -SourceFolder C:\Requirements -DestinationFolder "c:\hoge hoge" -DeployGroup new</code></td>
</tr>
<tr>
<td>2.</td>
<td>Asynchronous</td>
<td>Not yet ready.</td>
</tr>
</tbody>
</table><h1>
<a name="environment-setup-commands" class="anchor" href="#environment-setup-commands"><span class="octicon octicon-link"></span></a>Environment Setup Commands</h1>

<ul>
<li>Before you start valentia deployment, you should setup both Server and Clients to work PSRemote Connection.</li>
</ul><h3>
<a name="1-initialize-valentiaenvironment--setup-server" class="anchor" href="#1-initialize-valentiaenvironment--setup-server"><span class="octicon octicon-link"></span></a>1. <code>Initialize-ValentiaEnvironment</code> : Setup Server</h3>

<ul>
<li>This command will let your Server for valentia remoting.</li>
</ul><div class="highlight highlight-text"><pre>1. Set-ExecutionPolicy (Default : RemoteSigned)
2. Enable-PSRemoting
3. Add hosts to trustedHosts  (Default : *)
4. Set MaxShellsPerUser from 25 to 100
5. Add PowerShell Remoting Inbound rule to Firewall (Default : TCP 5985)
6. Disable Enhanced Security for Internet Explorer (Default : True)
7. Create OS user for Deploy connection. (Default : ec2-user)
8. Create Windows PowerShell Module Folder for DeployUser (Default : C:\Users\$ec2-user\Documents\WindowsPowerShell\Modules)
9. Create/Revise Deploy user credential secure file. (Server Only / Default : True)
10. Create Deploy Folders (Server Only / Default : True)
11. Set HostName as format (white-$HostUsage-IP)
12. Get Status for Reboot Status
</pre></div>

<ul>
<li>Once ran this command, You will got prompt for secret password of "OS User" (in default is ec2-user).</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="n">Initialize-ValentiaEnvironment</span> <span class="n">-Server</span> <span class="n">-TrustedHosts</span> <span class="s2">"*"</span>
</pre></div>

<ul>
<li>you can omit <code>-Server</code> and <code>-TrustedHosts "*"</code> as it were default </li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="n">Initialize-ValentiaEnvironment</span>
</pre></div>

<ul>
<li>When Credential prompt was display input password in masked read line, then OS user (in default ec2-user) will be created and all PSRemote session to all hosts are enabled.</li>
<li><p>Also trying to save password in secdure stirng in default, input deploy user password again.</p></li>
<li><p>If you want to restrict Trusted Hosts, you can use -TrustedHosts parameter to select. </p></li>
</ul><p>ex) restrict to 10.0.0.0</p>

<div class="highlight highlight-PowerShell"><pre><span class="n">Initialize-ValentiaServer</span> <span class="n">-TrustedHosts</span> <span class="s2">"10.0.0.0"</span>
</pre></div>

<ul>
<li>If you want setup without OS User setup? then add -NoOSUser switch. </li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="n">Initialize-ValentiaEnvironment</span> <span class="n">-Server</span> <span class="n">-TrustedHosts</span> <span class="s2">"*"</span> <span class="n">-NoOSUser</span>
</pre></div>

<ul>
<li>ServerOnly : If you want setup without OS User setup and Save Credentail? then add -NoPassSave switch.</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="n">Initialize-ValentiaEnvironment</span> <span class="n">-Server</span> <span class="n">-TrustedHosts</span> <span class="s2">"*"</span> <span class="n">-NoPassSave</span>
</pre></div>

<ul>
<li>Adding <code>-Verbose</code> switch will ease you check how function working.</li>
</ul><h3>
<a name="2-initialize-valentiaenvironment--client--setup-clients" class="anchor" href="#2-initialize-valentiaenvironment--client--setup-clients"><span class="octicon octicon-link"></span></a>2. <code>Initialize-ValentiaEnvironment -Client</code> : Setup Clients</h3>

<ul>
<li>
<p>This command will let your Client for valentia remoting.</p>

<ol>
<li>Set-ExecutionPolicy (Default : RemoteSigned)</li>
<li>Enable-PSRemoting</li>
<li>Add hosts to trustedHosts  (Default : *)</li>
<li>Set MaxShellsPerUser from 25 to 100</li>
<li>Add PowerShell Remoting Inbound rule to Firewall (Default : TCP 5985)</li>
<li>Disable Enhanced Security for Internet Explorer (Default : True)</li>
<li>Create OS user for Deploy connection. (Default : ec2-user)</li>
<li>Create Windows PowerShell Module Folder for DeployUser (Default : C:\Users\$ec2-user\Documents\WindowsPowerShell\Modules)</li>
<li>Create Deploy Folders (Server Only / Default : True)</li>
<li>Set HostName as format (white-$HostUsage-IP)</li>
<li>Get Status for Reboot Status</li>
</ol>
</li>
</ul><ul>
<li>Once ran this command, You will got prompt for secret password of "OS User" (in default is ec2-user).</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="n">Initialize-ValentiaEnvironment</span> <span class="n">-Client</span> <span class="n">-TrustedHosts</span> <span class="s2">"*"</span>
</pre></div>

<ul>
<li>you can omit <code>-TrustedHosts "*"</code> as it were default</li>
</ul><blockquote>
<ul>
<li><p>NOTE: If you sat Server and Client "SAME USER and SAME PASSWORD" then credential will be escaped.</p></li>
<li><p>This means, if you ran Initialize-ValentiaServer and Initialize-ValentiaClient, then ec2-user will be used and can be escape credential input.</p></li>
<li><p>Because of Parallel commands using workflow, (Domain separation), credential escape was required.</p></li>
<li><p>The other command can retrieve and use Credential, so other user credential will also valid for them.</p></li>
</ul>
</blockquote>

<ul>
<li>Wanna setup without OS User setup? then add -NoOSUser switch.</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="n">Initialize-ValentiaEnvironment</span> <span class="n">-Client</span> <span class="n">-TrustedHosts</span> <span class="s2">"*"</span> <span class="n">-NoOSUser</span>
</pre></div>

<ul>
<li>Adding <code>-Verbose</code> switch will ease you check how function working.</li>
</ul><h3>
<a name="3-new-valentiacredential--create-new-credential-secure-file" class="anchor" href="#3-new-valentiacredential--create-new-credential-secure-file"><span class="octicon octicon-link"></span></a>3. <code>New-ValentiaCredential</code> : Create New Credential secure file</h3>

<ul>
<li>Following command will make secure string file to save your credential.</li>
</ul><blockquote>
<p>If you ran Initialize-ValentiaServer without -NoSavePass switch, then you can skip this section.</p>

<p>However if you want to revise saved secure Password, then use this function to revise save file.</p>
</blockquote>

<div class="highlight highlight-PowerShell"><pre><span class="nb">New-ValentiaCredential</span>
</pre></div>

<ul>
<li>or you can select user for credential.</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="nb">New-ValentiaCredential</span> <span class="n">-User</span> <span class="n">hogehoge</span>
</pre></div>

<blockquote>
<p>NOTE: Once you execute command, you will got prompt to save secure strings of user.</p>

<p>Default user is sat as ec2-user, it will use if no -user had input.</p>
</blockquote>

<h3>
<a name="4-initialize-valentiagroup--create-new-deploygroup-file" class="anchor" href="#4-initialize-valentiagroup--create-new-deploygroup-file"><span class="octicon octicon-link"></span></a>4. <code>Initialize-ValentiaGroup</code> : Create New deploygroup file</h3>

<ul>
<li>To execute deployment command to multiple hosts, you don't need to input hosts everytime. Just list them up in file.</li>
<li>The file you specified will be output in following path.</li>
</ul><pre><code>C:\Deployment\Deploygroup\ *****.ps1
</code></pre>

<ul>
<li>Deploy Group file just required to be split by <code>r</code>n.</li>
<li>SAMPLE deployGroup input</li>
</ul><pre><code>10.0.0.100
10.0.0.101
# 10.0.0.101 &lt;= this line will be remarked as not started with decimal
</code></pre>

<ul>
<li>You can create deploy group file in only one command. Of cource there are several way to create deploygroup file.</li>
<li>You can make file with excel,notepad or powershell utils here.</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="nb">New-ValentiaGroup</span> <span class="n">-DeployClients</span> <span class="n">array</span><span class="p">[]</span> <span class="n">-FileName</span> <span class="n">FILENAME</span><span class="p">.</span><span class="n">ps1</span>
</pre></div>

<ul>
<li>SAMPLE CODE:</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="nb">New-ValentiaGroup</span> <span class="n">-DeployClients</span> <span class="s2">"10.0.0.1"</span><span class="p">,</span><span class="s2">"10.0.0.2"</span> <span class="n">-FileName</span> <span class="n">sample</span><span class="p">.</span><span class="n">ps1</span>
</pre></div>

<ul>
<li><p>This will make sample.ps1 in C:\Deployment\Deploy_group\ with 2 hosts ("10.0.0.1","10.0.0.2") written.</p></li>
<li><p>When using DeployGroup, just set file name without Extensions.</p></li>
</ul><p>ex) if you sat file name as "new.ps1" then use it by "new".</p>

<h3>
<a name="5-invoke-valentiadeploygroupremark--remark-ipaddress-for-deploygroup-file-inside-deploygroup" class="anchor" href="#5-invoke-valentiadeploygroupremark--remark-ipaddress-for-deploygroup-file-inside-deploygroup"><span class="octicon octicon-link"></span></a>5. <code>Invoke-valentiaDeployGroupRemark</code> : Remark ipaddress for deploygroup file inside deploygroup</h3>

<ul>
<li>There would be many time to remark some deploy target inside deploygroup file. This is easy work but boring to check which file contains target deploy ip.</li>
</ul><pre><code>C:\Deployment\Deploygroup\**\**\.....*****.ps1
</code></pre>

<ul>
<li>SAMPLE deployGroup input</li>
</ul><pre><code>10.0.0.100
10.0.0.101
10.0.0.102 &lt;= if you want to remark this line for all the files inside deploygroup folder.
</code></pre>

<ul>
<li>Just type as like this.</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="nb">Invoke-valentiaDeployGroupRemark</span> <span class="n">-remarkIPAddresses</span> <span class="n">10</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">102</span> <span class="n">-overWrite</span> <span class="n">-Verbose</span>
</pre></div>

<ul>
<li>This will change PowerShell</li>
</ul><pre><code>10.0.0.100
10.0.0.101
#10.0.0.102
</code></pre>

<ul>
<li>if you just want to check how affect and don't want to replace file, then remove -overwrite switch.</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="nb">Invoke-valentiaDeployGroupRemark</span> <span class="n">-remarkIPAddresses</span> <span class="n">10</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">102</span> <span class="n">-Verbose</span>
</pre></div>

<h3>
<a name="6-invoke-valentiadeploygroupunremark--unremark-ipaddress-for-deploygroup-file-inside-deploygroup" class="anchor" href="#6-invoke-valentiadeploygroupunremark--unremark-ipaddress-for-deploygroup-file-inside-deploygroup"><span class="octicon octicon-link"></span></a>6. <code>Invoke-valentiaDeployGroupUnremark</code> : Unremark ipaddress for deploygroup file inside deploygroup</h3>

<ul>
<li>if you remark ipaddresses in deploygroup file, then you want to unremark it:) This function will ease you unremark target ipaddresses and check how change.</li>
</ul><pre><code>C:\Deployment\Deploygroup\**\**\.....*****.ps1
</code></pre>

<ul>
<li>SAMPLE deployGroup input</li>
</ul><pre><code>10.0.0.100
10.0.0.101
#10.0.0.102 &lt;= if you want to unremark this line for all the files inside deploygroup folder.
</code></pre>

<ul>
<li>Just type as like this.</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="nb">Invoke-valentiaDeployGroupUnremark</span> <span class="n">-remarkIPAddresses</span> <span class="n">10</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">102</span> <span class="n">-overWrite</span> <span class="n">-Verbose</span>
</pre></div>

<ul>
<li>This will change PowerShell</li>
</ul><pre><code>10.0.0.100
10.0.0.101
10.0.0.102
</code></pre>

<ul>
<li>if you just want to check how affect and don't want to replace file, then remove -overwrite switch.</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="nb">Invoke-valentiaDeployGroupUnremark</span> <span class="n">-remarkIPAddresses</span> <span class="n">10</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">102</span> <span class="n">-Verbose</span>
</pre></div>

<h1>
<a name="task-for-commandset" class="anchor" href="#task-for-commandset"><span class="octicon octicon-link"></span></a>Task for Commandset</h1>

<h3>
<a name="summary-of-task" class="anchor" href="#summary-of-task"><span class="octicon octicon-link"></span></a>Summary of Task</h3>

<ul>
<li>You can make task file To execute many commands.</li>
<li>Write task in file with below format and save it in BranchFolders you want to work.</li>
</ul><blockquote>
<p>Note: BranchFolder will be C:\Deployment "application", "Image", "SWF", "SWF-Image", "Utils". (Created by Initialize-ValentiaServer)</p>
</blockquote>

<div class="highlight highlight-PowerShell"><pre><span class="n">Task</span> <span class="n">taskname</span> <span class="p">{</span>
    <span class="n">Commandset</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">run1</span>
    <span class="n">Commandset</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">run2</span>
<span class="p">}</span>
</pre></div>

<ul>
<li>After you made task, you should move to BranchFolder you saved task.</li>
</ul><h3>
<a name="convert-existing-ps1-to-task-and-setup-task" class="anchor" href="#convert-existing-ps1-to-task-and-setup-task"><span class="octicon octicon-link"></span></a>Convert existing .ps1 to task and setup task.</h3>

<ul>
<li>It's easy to convert normal .ps1 to task. Task file format is as below.</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="n">task</span> <span class="n">taskname</span> <span class="n">-Action</span> <span class="p">{</span>
    <span class="n">PowerShell</span> <span class="n">Commands</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">run</span>
<span class="p">}</span>
</pre></div>

<ul>
<li>If you have .ps1 like this code.</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="nb">Get-ChildItem</span>
</pre></div>

<ul>
<li>Then task will be like this.</li>
</ul><div class="highlight highlight-PowerShell"><pre><span class="n">task</span> <span class="n">taskname</span> <span class="n">-Action</span> <span class="p">{</span>
    <span class="nb">Get-ChildItem</span>
<span class="p">}</span>
</pre></div>

<ul>
<li>You can use almost all functions and variables set. Please check vale and valep section about a detail of some functions cannot use in task.</li>
</ul><blockquote>
<p>Note:</p>

<ul>
<li>valentia functions get stored credential before running task, therefore you don't need to create/write credentials in your script.</li>
<li>In other word, do not try to get another credential in you script. Especially in "valep" .</li>
</ul>
</blockquote>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Valentia maintained by <a href="https://github.com/guitarrapc">guitarrapc</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
